{"version":3,"file":"routes.js","sources":["routes.js","json!taoItems/preview/resources/device-list.json","../preview/tpl/preview!tpl","../preview/preview.js","items/action.js","items/edit.js","../../serviceApi/ServiceApi.js","../../serviceApi/PseudoStorage.js","../../serviceApi/UserInfoService.js","../runtime/ItemServiceImpl.js","../preview/preview-console.js","preview/itemRunner.js","runtime/itemRunner.js"],"names":["define","Items","deps","actions","editItem","ItemPreview","index","tablets","193986c3715c81838870f908fa98d69a","label","width","height","4e8eafab11aad1486992d7ee2c8c16ca","5aac2932d9ad00d6d8a1604b8f9e4e8d","9805d9753ad08c7630a9ee5418aa6c6c","d4a431cedf4705d6bf2cba6d5788378b","phones","1b89338531ef0155c8d6abc2ac02c81a","scaleFactor","dpWidth","dpHeight","3f89da99d84214cde7df87ebe0699a6f","0d36971a5b98b367f54ced708c9af849","026beffcc051af995660ebdede986ace","fd2dd53e667d6d49e4fa73356fa941dd","707584c1ae17d9b5b2cbe8603c91c147","91823264de952e7f2347e07db5c4058b","cd69817a6e147e8a4677389e56fcf568","75994faa6a38e31e99b53fcd75534a33","0cab4dfccdfc880687cb608cfe4159db","c4ff41fcba24d74fc21dc3490ca1edc9","fa969a5e0dd2de53700eeee4ba4ba142","33c4f9364e295ec03531f3a3425819cf","bc47f5275f0efd56fee52d43a8082981","0732887e6e324fd10777b735520a34cf","2e38a78364f09d0da0e9e1a3a68e7fb0","bd4b78dddc7c9625a4141a1b1ddabb87","3bf1edf21cfa81006183d2b02974c84e","ab5a352e0e016b97dac986f06c394f55","4826fb7d7257aeaac992ce699df41b3c","0a691ab20add7c432200f8fa6527b488","9c23ee31be29960fbac9e9bbfc2fc7b0","92177c0508c1d73905a58e2338f2a81f","5222b8866dc4cc606725e16ffcc0a783","37c1541e2bd55cfd0f4073b0ccdf68b3","2f7f64b7dda0144907ff300e83eed465","9c24f9057744dad56043702a9703127f","0a8b2732a016a9395c3af5f12dd9c0da","5a153d7f53d82dcb0801f041574a6a43","screens","9e523ae15b61dc766f5c818726881ecf","07769cd8d0a7d09818b2f0b018042fb7","72d5478a24194f98b9378e8e0fd65737","b7a6dd5900cc72e61f0d3479c7e314ec","43193b0ff671a37d8232ab664190a125","c29e48814af5443ff5688d9e967ce917","hb","template","Handlebars","depth0","helpers","partials","data","program1","stack1","helper","buffer","value","call","hash","functionType","escapeExpression","selected","inverse","self","noop","fn","program","program2","program4","dataValue","this","compilerInfo","merge","options","helperMissing","previewType","each","previewTypes","desktopDevices","mobileDevices","__","$","_","strPad","deviceList","previewTpl","overlay","container","typeDependant","$feedbackBox","$console","previewContainerMaxWidth","itemUri","orientation","desktop","mobile","standard","$doc","document","$window","window","$body","body","screenSize","innerWidth","innerHeight","maxDeviceSize","_getDeviceSelectorData","type","devices","forEach","Math","max","push","join","_setupTypeDependantElements","add","find","_setPreviewType","newType","re","RegExp","className","replace","_setOrientation","newOrientation","previewFrame","_scale","$scaleContainer","_scaleFactor","containerScaledWidth","left","css","-webkit-transform","-ms-transform","transform","-webkit-transform-origin","-ms-transform-origin","transform-origin","_positionPreview","paddingTop","outerHeight","_computeScaleFactor","scaleValues","x","y","requiredSize","min","_setupDeviceSelectors","previewDeviceSelectors","on","sizeSettings","elem","option","nodeName","toLowerCase","selectedIndex","val","split","i","length","parseFloat","_adaptFrameSize","select2","minimumResultsForSearch","_setupOrientationSelectors","_setupClosers","$closer","$feedbackCloser","$hideForever","$iframe","hide","off","attr","keyup","e","keyCode","trigger","preventDefault","cookie","expires","path","_getPreviewTypes","_previewLabel","_previewType","_setupViewSelector","$previewContainer","_iframe","contentHeight","contents","containerHeight","_updateStandardPreviewSize","$selector","values","toString","valueStr","_initConsole","$listing","event","message","timer","Date","logTime","getHours","getMinutes","getSeconds","msgStr","append","is","scrollTop","slideDown","show","slideUp","ajax","url","dataType","done","html","style","display","init","_itemUri","TypeError","remove","parseInt","binder","uri","context","preview","register","actionContext","_url","shownExtension","id","module","lock","feedback","editItemController","start","config","$lockBox","previewAction","getBy","authoringAction","checkoutMessage","success","timeout","state","disabled","isPreviewEnabled","isAuthoringEnabled","updateState","UrlParser","ServiceApi","baseUrl","parameters","serviceCallId","stateStorage","userService","connected","onFinishCallback","onKillCallback","onDisplayChangeCallback","SIG_SUCCESS","SIG_ERROR","prototype","loadInto","frame","$frame","callUrl","getCallUrl","isCORSAllowed","checkCORS","connect","contentWindow","__knownParent__","onServiceApiReady","params","param","getUserPropertyValues","property","callback","get","getServiceCallId","getState","setState","set","getParameter","identifier","onFinish","onKill","kill","finish","valueArray","PseudoStorage","UserInfoService","requestUrl","hasOwnProperty","service","r","key","ItemServiceImpl","itemId","serviceApi","resultApi","responses","scores","events","rawstate","parseJSON","stateVariables","beforeFinishCallbacks","itemApi","onItemApiReady","saveResponses","attrname","traceEvents","eventArray","saveScores","beforeFinish","submit","after","JSON","stringify","submitItemVariables","getVariable","setVariable","unserializeUrl","hashes","test","setup","$previewConsole","top","$consoleCtrls","$consoleContent","$consoleContentList","bind","hour","sec","empty","toggle","toggleClass","ajaxSuccess","request","settings","decodeURIComponent","eventData","name","exp","matchingDataList","responseText","previewConsole","iframeResizer","previewItemRunner","conf","previewUrl","resultServer","defaults","endpoint","require","ResultServerApi","resultServerApi","userInfoServiceRequestUrl","addParam","clientConfigUrl","autoHeight","getUrl","click","iframeNotifier","itemRunner","appendTo","itemPath","itemService","ItemService","itemUrl","parent","defer"],"mappings":"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","sourcesContent":["/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n * \n * \n */\n\n//@see http://forge.taotesting.com/projects/tao/wiki/Front_js\ndefine('taoItems/controller/routes',[],function(){\n    'use strict';\n    \n    return {\n        'Items' : {\n            'deps' : 'controller/items/action',\n            'actions' : {\n                'editItem' : 'controller/items/edit'\n            }\n        },\n        'ItemPreview' : {\n            'actions' : {\n                'index' : 'controller/preview/itemRunner'\n            }\n        }\n    };\n});\n\n","\ndefine(\"json!taoItems/preview/resources/device-list.json\", function(){ return {\n    \"tablets\": {\n        \"193986c3715c81838870f908fa98d69a\": {\n            \"label\": \"Amazon Kindle Fire HDX 7\\u2033\",\n            \"width\": 960,\n            \"height\": 600\n        },\n        \"4e8eafab11aad1486992d7ee2c8c16ca\": {\n            \"label\": \"Apple iPad\",\n            \"width\": 1024,\n            \"height\": 768\n        },\n        \"5aac2932d9ad00d6d8a1604b8f9e4e8d\": {\n            \"label\": \"Google Nexus 10, Motorola Xoom, Xyboard\",\n            \"width\": 1280,\n            \"height\": 800\n        },\n        \"9805d9753ad08c7630a9ee5418aa6c6c\": {\n            \"label\": \"Google Nexus 7\",\n            \"width\": 966,\n            \"height\": 604\n        },\n        \"d4a431cedf4705d6bf2cba6d5788378b\": {\n            \"label\": \"Samsung Galaxy Tab 7.7, 8.9, 10.1\",\n            \"width\": 1280,\n            \"height\": 800\n        }\n    },\n    \"phones\": {\n        \"1b89338531ef0155c8d6abc2ac02c81a\": {\n            \"label\": \"Apple iPhone 3GS\",\n            \"width\": 320,\n            \"height\": 480,\n            \"scaleFactor\": 1,\n            \"dpWidth\": 320,\n            \"dpHeight\": 480\n        },\n        \"3f89da99d84214cde7df87ebe0699a6f\": {\n            \"label\": \"Apple iPhone 4\",\n            \"width\": 640,\n            \"height\": 960,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1920\n        },\n        \"0d36971a5b98b367f54ced708c9af849\": {\n            \"label\": \"Apple iPhone 5\",\n            \"width\": 640,\n            \"height\": 1136,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 320,\n            \"dpHeight\": 2272\n        },\n        \"026beffcc051af995660ebdede986ace\": {\n            \"label\": \"BlackBerry Z10\",\n            \"width\": 768,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 384,\n            \"dpHeight\": 2560\n        },\n        \"fd2dd53e667d6d49e4fa73356fa941dd\": {\n            \"label\": \"BlackBerry Z30\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 360,\n            \"dpHeight\": 2560\n        },\n        \"707584c1ae17d9b5b2cbe8603c91c147\": {\n            \"label\": \"Google Nexus 4\",\n            \"width\": 768,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 384,\n            \"dpHeight\": 2560\n        },\n        \"91823264de952e7f2347e07db5c4058b\": {\n            \"label\": \"Google Nexus 5\",\n            \"width\": 1080,\n            \"height\": 1920,\n            \"scaleFactor\": 3,\n            \"dpWidth\": 360,\n            \"dpHeight\": 5760\n        },\n        \"cd69817a6e147e8a4677389e56fcf568\": {\n            \"label\": \"Google Nexus S\",\n            \"width\": 480,\n            \"height\": 800,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1200\n        },\n        \"75994faa6a38e31e99b53fcd75534a33\": {\n            \"label\": \"HTC Evo, Touch HD, Desire HD, Desire\",\n            \"width\": 480,\n            \"height\": 800,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1200\n        },\n        \"0cab4dfccdfc880687cb608cfe4159db\": {\n            \"label\": \"HTC One X, EVO LTE\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 360,\n            \"dpHeight\": 2560\n        },\n        \"c4ff41fcba24d74fc21dc3490ca1edc9\": {\n            \"label\": \"HTC Sensation, Evo 3D\",\n            \"width\": 540,\n            \"height\": 960,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 360,\n            \"dpHeight\": 1440\n        },\n        \"fa969a5e0dd2de53700eeee4ba4ba142\": {\n            \"label\": \"LG Optimus 2X, Optimus 3D, Optimus Black\",\n            \"width\": 480,\n            \"height\": 800,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1200\n        },\n        \"33c4f9364e295ec03531f3a3425819cf\": {\n            \"label\": \"LG Optimus G\",\n            \"width\": 768,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 384,\n            \"dpHeight\": 2560\n        },\n        \"bc47f5275f0efd56fee52d43a8082981\": {\n            \"label\": \"LG Optimus LTE, Optimus 4X HD\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 1.7,\n            \"dpWidth\": 424,\n            \"dpHeight\": 2176\n        },\n        \"0732887e6e324fd10777b735520a34cf\": {\n            \"label\": \"LG Optimus One\",\n            \"width\": 320,\n            \"height\": 480,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 213,\n            \"dpHeight\": 720\n        },\n        \"2e38a78364f09d0da0e9e1a3a68e7fb0\": {\n            \"label\": \"Motorola Defy, Droid, Droid X, Milestone\",\n            \"width\": 480,\n            \"height\": 854,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1281\n        },\n        \"bd4b78dddc7c9625a4141a1b1ddabb87\": {\n            \"label\": \"Motorola Droid 3, Droid 4, Droid Razr, Atrix 4G, Atrix 2\",\n            \"width\": 540,\n            \"height\": 960,\n            \"scaleFactor\": 1,\n            \"dpWidth\": 540,\n            \"dpHeight\": 960\n        },\n        \"3bf1edf21cfa81006183d2b02974c84e\": {\n            \"label\": \"Motorola Droid Razr HD\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 1,\n            \"dpWidth\": 720,\n            \"dpHeight\": 1280\n        },\n        \"ab5a352e0e016b97dac986f06c394f55\": {\n            \"label\": \"Nokia C5, C6, C7, N97, N8, X7\",\n            \"width\": 360,\n            \"height\": 640,\n            \"scaleFactor\": 1,\n            \"dpWidth\": 360,\n            \"dpHeight\": 640\n        },\n        \"4826fb7d7257aeaac992ce699df41b3c\": {\n            \"label\": \"Nokia Lumia 7X0, Lumia 8XX, Lumia 900, N800, N810, N900\",\n            \"width\": 480,\n            \"height\": 800,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1200\n        },\n        \"0a691ab20add7c432200f8fa6527b488\": {\n            \"label\": \"Samsung Galaxy Note\",\n            \"width\": 800,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 400,\n            \"dpHeight\": 2560\n        },\n        \"9c23ee31be29960fbac9e9bbfc2fc7b0\": {\n            \"label\": \"Samsung Galaxy Note 3\",\n            \"width\": 1080,\n            \"height\": 1920,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 540,\n            \"dpHeight\": 3840\n        },\n        \"92177c0508c1d73905a58e2338f2a81f\": {\n            \"label\": \"Samsung Galaxy Note II\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 360,\n            \"dpHeight\": 2560\n        },\n        \"5222b8866dc4cc606725e16ffcc0a783\": {\n            \"label\": \"Samsung Galaxy S III, Galaxy Nexus\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 360,\n            \"dpHeight\": 2560\n        },\n        \"37c1541e2bd55cfd0f4073b0ccdf68b3\": {\n            \"label\": \"Samsung Galaxy S, S II, W\",\n            \"width\": 480,\n            \"height\": 800,\n            \"scaleFactor\": 1.5,\n            \"dpWidth\": 320,\n            \"dpHeight\": 1200\n        },\n        \"2f7f64b7dda0144907ff300e83eed465\": {\n            \"label\": \"Samsung Galaxy S4\",\n            \"width\": 1080,\n            \"height\": 1920,\n            \"scaleFactor\": 3,\n            \"dpWidth\": 360,\n            \"dpHeight\": 5760\n        },\n        \"9c24f9057744dad56043702a9703127f\": {\n            \"label\": \"Sony Xperia S, Ion\",\n            \"width\": 720,\n            \"height\": 1280,\n            \"scaleFactor\": 2,\n            \"dpWidth\": 360,\n            \"dpHeight\": 2560\n        },\n        \"0a8b2732a016a9395c3af5f12dd9c0da\": {\n            \"label\": \"Sony Xperia Sola, U\",\n            \"width\": 480,\n            \"height\": 854,\n            \"scaleFactor\": 1,\n            \"dpWidth\": 480,\n            \"dpHeight\": 854\n        },\n        \"5a153d7f53d82dcb0801f041574a6a43\": {\n            \"label\": \"Sony Xperia Z, Z1\",\n            \"width\": 1080,\n            \"height\": 1920,\n            \"scaleFactor\": 3,\n            \"dpWidth\": 360,\n            \"dpHeight\": 5760\n        }\n    },\n    \"screens\": {\n        \"9e523ae15b61dc766f5c818726881ecf\": {\n            \"label\": \"1920 \\u00d7 1080\",\n            \"width\": 1920,\n            \"height\": 1080,\n            \"dpWidth\": 1920,\n            \"dpHeight\": 1080,\n            \"scaleFactor\": 1\n        },\n        \"07769cd8d0a7d09818b2f0b018042fb7\": {\n            \"label\": \"1366 \\u00d7 768\",\n            \"width\": 1366,\n            \"height\": 768,\n            \"dpWidth\": 1366,\n            \"dpHeight\": 768,\n            \"scaleFactor\": 1\n        },\n        \"72d5478a24194f98b9378e8e0fd65737\": {\n            \"label\": \"1280 \\u00d7 1024\",\n            \"width\": 1280,\n            \"height\": 1024,\n            \"dpWidth\": 1280,\n            \"dpHeight\": 1024,\n            \"scaleFactor\": 1\n        },\n        \"b7a6dd5900cc72e61f0d3479c7e314ec\": {\n            \"label\": \"1280 \\u00d7 800\",\n            \"width\": 1280,\n            \"height\": 800,\n            \"dpWidth\": 1280,\n            \"dpHeight\": 800,\n            \"scaleFactor\": 1\n        },\n        \"43193b0ff671a37d8232ab664190a125\": {\n            \"label\": \"1024 \\u00d7 768\",\n            \"width\": 1024,\n            \"height\": 768,\n            \"dpWidth\": 1024,\n            \"dpHeight\": 768,\n            \"scaleFactor\": 1\n        },\n        \"c29e48814af5443ff5688d9e967ce917\": {\n            \"label\": \"800 \\u00d7 600\",\n            \"width\": 800,\n            \"height\": 600,\n            \"dpWidth\": 800,\n            \"dpHeight\": 600,\n            \"scaleFactor\": 1\n        }\n    }\n};});\n\n","\ndefine('tpl!taoItems/preview/tpl/preview', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, functionType=\"function\", escapeExpression=this.escapeExpression, self=this, helperMissing=helpers.helperMissing;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n                        <option value=\\\"\";\n  if (helper = helpers.value) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.value); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.selected), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</option>\\n                        \";\n  return buffer;\n  }\nfunction program2(depth0,data) {\n  \n  \n  return \"selected=\\\"selected\\\"\";\n  }\n\nfunction program4(depth0,data) {\n  \n  var buffer = \"\", stack1, helper;\n  buffer += \"\\n                        <option value=\\\"\";\n  if (helper = helpers.value) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.value); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" data-value=\\\"\";\n  if (helper = helpers.dataValue) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.dataValue); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"\\\" \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.selected), {hash:{},inverse:self.noop,fn:self.program(2, program2, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \">\";\n  if (helper = helpers.label) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.label); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"</option>\\n                        \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"preview-overlay tao-scope overlay preview-\";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \" item-no-print\\\"\\n     style=\\\"overflow-x: hidden;display:none\\\">\\n    <div class=\\\"preview-container-outer\\\">\\n        <form class=\\\"preview-utility-bar plain\\\">\\n            <div class=\\\"preview-utility-bar-inner grid-row\\\">\\n\\n                <div class=\\\"col-4\\\">\\n                    <input type=\\\"hidden\\\" value=\\\"\\\" data-value=\\\"\\\" class=\\\"standard-device-selector preview-device-selector\\\" data-target=\\\"standard\\\">\\n                    <select class=\\\"preview-type-selector\\\">\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.previewTypes), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                    </select>\\n                </div>\\n                <div class=\\\"col-6 standard-only device-type-and-orientation\\\"></div>\\n                <div class=\\\"col-6 desktop-only device-type-and-orientation\\\">\\n                    <select class=\\\"desktop-device-selector preview-device-selector\\\" data-target=\\\"desktop\\\">\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.desktopDevices), {hash:{},inverse:self.noop,fn:self.program(4, program4, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                    </select>\\n                </div>\\n                <div class=\\\"col-6 mobile-only device-type-and-orientation\\\">\\n                    <select class=\\\"mobile-device-selector preview-device-selector\\\" data-target=\\\"mobile\\\">\\n                        \";\n  stack1 = helpers.each.call(depth0, (depth0 && depth0.mobileDevices), {hash:{},inverse:self.noop,fn:self.program(4, program4, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\n                    </select>\\n                    <select tabindex=\\\"-1\\\" class=\\\"mobile-orientation-selector orientation-selector\\\"\\n                            data-target=\\\"mobile\\\">\\n                        <option value=\\\"landscape\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Landscape\", options) : helperMissing.call(depth0, \"__\", \"Landscape\", options)))\n    + \"</option>\\n                        <option value=\\\"portrait\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Portrait\", options) : helperMissing.call(depth0, \"__\", \"Portrait\", options)))\n    + \"</option>\\n                    </select>\\n                </div>\\n                <div class=\\\"col-2\\\">\\n                    <!--label>\\n                        <input type=\\\"checkbox\\\"/>\\n                        <span class=\\\"icon-checkbox\\\"></span>\\n                        \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Scale \", options) : helperMissing.call(depth0, \"__\", \"Scale \", options)))\n    + \"\\n                    </label-->\\n                        <span class=\\\"btn-info small preview-closer rgt\\\">\\n                            \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close\", options) : helperMissing.call(depth0, \"__\", \"Close\", options)))\n    + \"\\n                            <span class=\\\"icon-close r\\\"></span>\\n                        </span>\\n                </div>\\n            </div>\\n            <div class=\\\"preview-message-box\\\">\\n                <div class=\\\"feedback-info small\\\">\\n                    <span class=\\\"icon-info\\\"></span>\\n                    \"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"This preview may be scaled to fit your screen. The final rendering may differ.\", options) : helperMissing.call(depth0, \"__\", \"This preview may be scaled to fit your screen. The final rendering may differ.\", options)))\n    + \"\\n                    <a href=\\\"#\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Don’t show this again!\", options) : helperMissing.call(depth0, \"__\", \"Don’t show this again!\", options)))\n    + \"</a>\\n                    <span title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Remove this message\", options) : helperMissing.call(depth0, \"__\", \"Remove this message\", options)))\n    + \"\\\" class=\\\"icon-close close-trigger\\\"></span>\\n                </div>\\n            </div>\\n        </form>\\n        <div class=\\\"preview-canvas\\\">\\n\\n            <div class=\\\"preview-scale-container\\\">\\n                <div class=\\\"\";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"-preview-frame preview-outer-frame \";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"-preview-landscape\\\">\\n                    <div class=\\\"\";\n  if (helper = helpers.previewType) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.previewType); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"-preview-container preview-container\\\">\\n                        <div class=\\\"preview-item-container\\\"></div>\\n                    </div>\\n                </div>\\n            </div>\\n        </div>\\n    </div>\\n    <div id=\\\"preview-console\\\">\\n        <span class=\\\"icon-close preview-console-closer\\\" title=\\\"\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Close console\", options) : helperMissing.call(depth0, \"__\", \"Close console\", options)))\n    + \"\\\"></span>\\n\\n        <div class=\\\"preview-console-header grid-row clearfix\\\">\\n            <div class=\\\"col-12\\\">\\n                <button type=\\\"button\\\" class=\\\"btn-info small rgt\\\" id=\\\"preview-submit-button\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Submit\", options) : helperMissing.call(depth0, \"__\", \"Submit\", options)))\n    + \"</button>\\n            </div>\\n        </div>\\n        <div class=\\\"preview-console-body clear\\\">\\n            <ul></ul>\\n        </div>\\n    </div>\\n</div>\";\n  return buffer;\n  });\n});\n\n","define('taoItems/preview/preview',[\n    'jquery',\n    'lodash',\n    'i18n',\n    'util/strPad',\n    'json!taoItems/preview/resources/device-list.json',\n    'tpl!taoItems/preview/tpl/preview',\n    'ui/modal',\n    'select2',\n    'jquery.cookie'\n], function ($, _, __, strPad, deviceList, previewTpl) {\n    'use strict';\n\n    var overlay,\n        container,\n        orientation = 'landscape',\n        previewType = 'standard',\n        previewTypes = {\n            desktop: __('Desktop preview'),\n            mobile: __('Mobile preview'),\n            standard: __('Actual size')\n        },\n        $doc = $(document),\n        $window = $(window),\n        $body = $(document.body),\n        screenSize = {\n            width: $window.innerWidth(),\n            height: $window.innerHeight()\n        },\n        maxDeviceSize = {\n            width: 0,\n            height: 0\n        },\n        scaleFactor = 1,\n        typeDependant,\n        $feedbackBox,\n        $console,\n        previewContainerMaxWidth,\n        itemUri;\n\n\n    /**\n     * Create data set for device selectors\n     *\n     * @param type\n     * @returns {Array}\n     * @private\n     */\n    var _getDeviceSelectorData = function (type) {\n\n        /*\n         * @todo\n         * The device list is currently based on the devices found on the Chrome emulator.\n         * This is not ideal and should be changed in the future.\n         * I have http://en.wikipedia.org/wiki/List_of_displays_by_pixel_density in mind but we\n         * will need to figure what criteria to apply when generating the list.\n         */\n        var devices = type === 'mobile' ? deviceList.tablets : deviceList.screens,\n            options = [];\n\n        _.forEach(devices, function (value) {\n\n            // figure out the widest possible screen to calculate the scale factor\n            maxDeviceSize = {\n                width: Math.max(maxDeviceSize.width, value.width),\n                height: Math.max(maxDeviceSize.height, value.height)\n            };\n\n            options.push({\n                value: value.label,\n                label: value.label,\n                dataValue: [value.width, value.height].join(','),\n                selected: previewType === value.label\n            });\n        });\n\n\n        return options;\n    };\n\n    /**\n     * Collect all elements that can toggle their class name between mobile-* and desktop-*\n     *\n     * @private\n     */\n    var _setupTypeDependantElements = function () {\n        typeDependant = overlay.add(overlay.find('.preview-scale-container').find('[class*=\"' + previewType + '\"]'));\n    };\n\n\n    /**\n     * Change the class name of all type dependant elements\n     *\n     * @param type\n     */\n    var _setPreviewType = function (newType) {\n\n        if (newType === previewType) {\n            return;\n        }\n        var re = new RegExp(previewType, 'g');\n\n        typeDependant.each(function () {\n            this.className = this.className.replace(re, newType);\n        });\n\n        previewType = newType;\n    };\n\n\n    /**\n     * Set orientation\n     *\n     * @param newOrientation\n     * @private\n     */\n    var _setOrientation = function (newOrientation) {\n        if (newOrientation === orientation) {\n            return;\n        }\n\n        var re = new RegExp(orientation, 'g'),\n            previewFrame = $('.preview-outer-frame')[0];\n\n        previewFrame.className = previewFrame.className.replace(re, newOrientation);\n\n        // reset global orientation\n        orientation = newOrientation;\n    };\n\n    /**\n     * Scale devices down to fit screen\n     * @private\n     */\n    var _scale = function () {\n\n        var $scaleContainer = $('.preview-scale-container'),\n            _scaleFactor = previewType === 'standard' ? 1 : scaleFactor,\n            containerScaledWidth = $scaleContainer.width() * _scaleFactor,\n            left = (screenSize.width - containerScaledWidth) / 2;\n\n        $scaleContainer.css({\n            left: left,\n            '-webkit-transform': 'scale(' + _scaleFactor + ',' + _scaleFactor + ')',\n            '-ms-transform': 'scale(' + _scaleFactor + ',' + _scaleFactor + ')',\n            'transform': 'scale(' + _scaleFactor + ',' + _scaleFactor + ')',\n            '-webkit-transform-origin': '0 0',\n            '-ms-transform-origin': '0 0',\n            'transform-origin': '0 0'\n        });\n    };\n\n    /**\n     * position the preview depending on the height of the toolbar\n     *\n     * @private\n     */\n    var _positionPreview = function () {\n        $('.preview-canvas').css({ paddingTop: $('.preview-utility-bar').outerHeight() + 5 })\n    };\n\n\n    /**\n     * Compute scale factor based on screen size and device size\n     *\n     * @private\n     */\n    var _computeScaleFactor = function () {\n\n        var scaleValues = {\n            x: 1,\n            y: 1\n        };\n\n        // 150/200 = device frames plus toolbar plus console plus some margin\n\n        var requiredSize = {\n            width: maxDeviceSize.width + 150,\n            height: maxDeviceSize.height + 275\n        };\n\n        if (requiredSize.width > screenSize.width) {\n            scaleValues.x = screenSize.width / requiredSize.width;\n        }\n\n        if (requiredSize.height > screenSize.height) {\n            scaleValues.y = screenSize.height / requiredSize.height;\n        }\n\n        scaleFactor = Math.min(scaleValues.x, scaleValues.y);\n    };\n\n    /**\n     * Add functionality to device selectors\n     *\n     * @private\n     */\n    var _setupDeviceSelectors = function () {\n\n\n        var previewDeviceSelectors = overlay.find('.preview-device-selector');\n\n        previewDeviceSelectors.on('change', function () {\n            var elem = $(this),\n                option = this.nodeName.toLowerCase() === 'select' ? this.options[this.selectedIndex] : this,\n                type = elem.data('target'),\n                val = $(option).data('value').split(','),\n                sizeSettings,\n                i = val.length,\n                container = overlay.find('.' + type + '-preview-container');\n\n\n            while (i--) {\n                val[i] = parseFloat(val[i]);\n            }\n\n            if (type === 'mobile' && orientation === 'portrait') {\n                sizeSettings = {\n                    width: val[1],\n                    height: val[0]\n                };\n            }\n            else {\n                sizeSettings = {\n                    width: val[0],\n                    height: val[1]\n                };\n            }\n\n            if (sizeSettings.width === container.width() && sizeSettings.height === container.height()) {\n                return false;\n            }\n            _setPreviewType(type);\n            container.css(sizeSettings);\n            _scale();\n            _adaptFrameSize();\n        });\n\n        previewDeviceSelectors.each(function () {\n            if (this.nodeName.toLowerCase() === 'select') {\n                $(this).select2({\n                    minimumResultsForSearch: -1\n                });\n            }\n        });\n    };\n\n    /**\n     * Setup orientation selector. There is no actual orientation switch for desktop but it could\n     * be added easily if required.\n     * @private\n     */\n    var _setupOrientationSelectors = function () {\n\n        $('select.orientation-selector').on('change',function () {\n\n            var type = $(this).data('target'),\n                previewFrame = $('.' + type + '-preview-frame'),\n                container = previewFrame.find('.' + type + '-preview-container'),\n                sizeSettings,\n                newOrientation = $(this).val();\n\n            if (newOrientation === orientation) {\n                return false;\n            }\n\n            sizeSettings = {\n                height: container.width(),\n                width: container.height()\n            };\n\n            container.css(sizeSettings);\n            _scale();\n            _adaptFrameSize();\n\n\n            _setOrientation(newOrientation);\n\n        }).select2({\n            minimumResultsForSearch: -1\n        });\n    };\n\n    /**\n     * Close preview\n     *\n     * @returns {*|HTMLElement}\n     */\n    var _setupClosers = function () {\n        var $closer = overlay.find('.preview-closer'),\n            $feedbackCloser = $feedbackBox.find('.close-trigger'),\n            $hideForever = $feedbackBox.find('a');\n        var $iframe = $('#preview-iframe');\n\n        $closer.on('click', function () {\n//            commonRenderer.setContext($('.item-editor-item'));\n            overlay.hide();\n\n            //empty the iframe\n            $iframe.off('load').attr('src', 'about:blank');\n        });\n\n        $doc.keyup(function (e) {\n            if (e.keyCode === 27) {\n                $closer.trigger('click');\n            }\n        });\n\n        $feedbackCloser.on('click', function () {\n            $feedbackBox.hide();\n            _positionPreview();\n            _scale();\n        });\n\n        $hideForever.on('click', function (e) {\n            e.preventDefault();\n            $.cookie('hidePreviewFeedback', true, { expires: 1000, path: '/' });\n            $feedbackCloser.trigger('click');\n        });\n    };\n\n    /**\n     * Build options for preview types\n     *\n     * @returns {Array}\n     * @private\n     */\n    var _getPreviewTypes = function () {\n        var options = [];\n        _(previewTypes).forEach(function (_previewLabel, _previewType) {\n            options.push({\n                value: _previewType,\n                label: _previewLabel,\n                selected: previewType === _previewType\n            });\n        });\n        return options;\n    };\n\n    /**\n     * Select preview type\n     *\n     * @private\n     */\n    var _setupViewSelector = function () {\n\n        $('select.preview-type-selector').on('change',function () {\n            var _previewType = $(this),\n                value = _previewType.val();\n\n            _setPreviewType(value);\n\n            $('.' + value + '-device-selector').trigger('change');\n        }).select2({\n            minimumResultsForSearch: -1\n        });\n\n    };\n\n    var _adaptFrameSize = function () {\n\n        var $previewContainer = $('.preview-container'),\n            $iframe = (function () {\n                var _iframe = $previewContainer.find('iframe');\n                _iframe.height('');\n                return _iframe;\n            }()),\n            contentHeight = $iframe.contents().outerHeight(),\n            containerHeight = $previewContainer.innerHeight();\n\n        if (previewType !== 'standard') {\n            if (contentHeight < containerHeight) {\n                contentHeight = containerHeight;\n            }\n        }\n        else {\n            $previewContainer.height(contentHeight + 10);\n        }\n\n        $iframe.height(contentHeight);\n    };\n\n\n    /**\n     * Set the size for the standard preview\n     * @param height\n     * @private\n     */\n    var _updateStandardPreviewSize = function (height) {\n        var $selector = $('.standard-device-selector'),\n            values = ($selector.val() ? $selector.val().split(',') : '') || [$window.width().toString()],\n            valueStr = values.join(',');\n\n        values[1] = height || values[1] || '1200';\n\n        $selector.val(valueStr).data('value', valueStr);\n    };\n\n    var _initConsole = function () {\n\n        var $body = $console.find('.preview-console-body'),\n            $listing = $body.find('ul'),\n            $closer = $console.find('.preview-console-closer');\n\n        $console.off('updateConsole').on('updateConsole', function (event, type, message) {\n            var timer = new Date(),\n                logTime = [\n                    strPad(timer.getHours(), 2, '0', 'STR_PAD_LEFT'),\n                    strPad(timer.getMinutes(), 2, '0', 'STR_PAD_LEFT'),\n                    strPad(timer.getSeconds(), 2, '0', 'STR_PAD_LEFT')\n                ].join(':'),\n                msgStr = '<span class=\"log-time\">' + strPad(logTime, 12, ' ') + '</span> '\n                    + '<span class=\"log-type\">' + strPad(type, 18, ' ') + '</span> '\n                    + '<span class=\"log-message\">' + strPad(message, 18, ' ') + '</span>';\n            $listing.append('<li><pre>' + msgStr + '</pre></li>');\n            if (!$body.is(':visible')) {\n                $body.slideDown('slow', function () {\n                    $closer.show();\n                    $listing.scrollTop(10000);\n                });\n            }\n            else {\n                $listing.scrollTop(10000);\n            }\n        });\n\n        $closer.on('click', function () {\n            $body.slideUp('slow', function () {\n                $closer.hide();\n            });\n        });\n    };\n\n\n    /**\n     * Display the preview\n     */\n    var show = function () {\n\n        $.ajax({\n            url: itemUri,\n            dataType: 'html'\n        }).done(function (data) {\n            $('.preview-item-container').html(data);\n        });\n\n        // $.show() does not work from the item manager\n        // this is either a miracle or a jquery bug\n        // overlay.hide().show();\n        overlay[0].style.display = 'block';\n        overlay.height('100%');\n        overlay.find('select:visible').trigger('change');\n        _scale();\n        _positionPreview();\n    };\n\n    /**\n     * Create preview\n     *\n     * @param string _itemUri\n     */\n    var init = function (_itemUri) {\n\n        if(!_itemUri || _itemUri.length === 0){\n            throw new TypeError('Wrong URI');\n        }\n\n        $('.preview-overlay').remove();\n        container = null;\n        overlay = $(previewTpl({\n            mobileDevices: _getDeviceSelectorData('mobile'),\n            desktopDevices: _getDeviceSelectorData('desktop'),\n            previewTypes: _getPreviewTypes(),\n            previewType: previewType\n        }));\n\n        $body.append(overlay);\n\n        previewContainerMaxWidth = parseInt($('.preview-container').css('max-width'), 10);\n\n        $feedbackBox = overlay.find('.preview-message-box');\n        if ($.cookie('hidePreviewFeedback')) {\n            $feedbackBox.hide();\n        }\n\n        $console = overlay.find('#preview-console');\n\n        _initConsole();\n        _updateStandardPreviewSize();\n        _setupTypeDependantElements();\n        _setupDeviceSelectors();\n        _setupOrientationSelectors();\n        _setupViewSelector();\n        _setupClosers();\n        _computeScaleFactor();\n        _setPreviewType(previewType);\n        _setOrientation(orientation);\n\n        $window.on('resize orientationchange', function (e) {\n            screenSize = {\n                width: $window.innerWidth(),\n                height: $window.innerHeight()\n            };\n            _updateStandardPreviewSize();\n            _computeScaleFactor();\n            _scale();\n        });\n\n        itemUri = _itemUri;\n\n        return overlay;\n    };\n\n    return {\n        init: init,\n        show: show\n    };\n});\n\n","define('taoItems/controller/items/action',[\n    'layout/actions/binder',\n    'uri',\n    'jquery',\n    'context',\n    'taoItems/preview/preview',\n    'helpers'\n], function(binder, uri, $, context, preview, helpers){\n\n    binder.register('itemPreview', function itemPreview(actionContext){\n        preview.init(helpers._url('forwardMe', 'ItemPreview', context.shownExtension, {uri : actionContext.id}));\n        preview.show();\n    });\n\n});\n\n","\ndefine('taoItems/controller/items/edit',['module', 'layout/actions', 'jquery','helpers','ui/lock', 'ui/feedback', 'i18n'],\n\tfunction(module, actions, $, helpers, lock, feedback, __){\n\n        var editItemController = {\n            start : function(){\n                var config = module.config();\n                var $lockBox = $('#lock-box');\n\n                var previewAction = actions.getBy('item-preview');\n                var authoringAction = actions.getBy('item-authoring');\n\n                //if there is no lock display a message on enter authoring\n                if(config.checkoutMessage !== '' && $lockBox.length === 0){\n                    $('#item-authoring').on('click',function(){\n                        feedback().success(config.checkoutMessage, {\n                            timeout: {\n                                success: 4000\n                            }});\n                    });\n                }\n\n                if(previewAction){\n                    previewAction.state.disabled = !config.isPreviewEnabled;\n                }\n                if(authoringAction){\n                    authoringAction.state.disabled = !config.isAuthoringEnabled;\n                }\n                actions.updateState();\n\n                $lockBox.each(function() {lock($(this)).register()});\n            }\n        };\n\n        return editItemController;\n});\n\n","define('serviceApi/ServiceApi',['jquery', 'urlParser', 'iframeResizer'], function($, UrlParser, iframeResizer){\n    \n    function ServiceApi(baseUrl, parameters, serviceCallId, stateStorage, userService){\n        this.baseUrl = baseUrl;\n        this.parameters = parameters;\n        this.connected = false;\n\n        this.serviceCallId = serviceCallId; \n        this.state = stateStorage;\n        this.userService = userService;\n\n        this.onFinishCallback;\n        this.onKillCallback;\n        this.onDisplayChangeCallback;\n    }\n\n    ServiceApi.SIG_SUCCESS = 0; \n    ServiceApi.SIG_ERROR = 1;\n        \n    ServiceApi.prototype.loadInto = function(frame, connected){\n        var self = this;\n        var $frame = $(frame);\n        var callUrl = this.getCallUrl();        \n        var isCORSAllowed = new UrlParser(callUrl).checkCORS();\n\n        $frame.on('load', function(e){\n             //if we are  in the same domain, we add a variable\n             //to the frame window, so the frame knows it can communicate\n             //with the parent\n            $(document).on('serviceready', function(){\n                self.connect(frame, function(){\n                    $(document).off('serviceready');\n                    if(typeof connected === 'function'){\n                        connected();\n                    }\n                });\n            });\n             if(isCORSAllowed === true){\n                 frame.contentWindow.__knownParent__ = true;\n             }\n         });\n\n        $frame.attr('src', callUrl);\n    };\n\n    ServiceApi.prototype.connect = function(frame, connected){\n        if(this.connected === false && frame.contentWindow){\n            //frame.contentWindow.serviceApi = this;\n            if (typeof(frame.contentWindow.onServiceApiReady) === \"function\") {\n                frame.contentWindow.onServiceApiReady(this);\n                this.connected = true;\n                if(typeof connected === 'function'){\n                    connected();\n                }\n            }\n        }\n    };\n    \n    /**\n     * Get the service call URL\n     * @returns {String} the URI\n     */\n    ServiceApi.prototype.getCallUrl = function(){\n        var params = this.parameters || {};\n        params.serviceCallId = this.serviceCallId;\n        return this.baseUrl + '?' + $.param(params);\n    };\n\n    ServiceApi.prototype.getUserPropertyValues = function(property, callback){\n    \tthis.userService.get(property, callback);\n    };\n    \n    //Context\n    ServiceApi.prototype.getServiceCallId = function(){\n        return this.serviceCallId;\n    };\n\n    //Context\n    ServiceApi.prototype.getState = function(){\n        return this.state.get();\n    };\n\n    ServiceApi.prototype.setState = function(state, callback){\n        return this.state.set(state, callback);\n    };\n\n    // Variables \n    ServiceApi.prototype.getParameter = function(identifier){\n        if (typeof(this.parameters[identifier]) !== \"undefined\") {\n            return this.parameters[identifier];\n        } else {\n            return null;\n        }\n    };\n\n    ServiceApi.prototype.onFinish = function(callback) {\n        this.onFinishCallback = callback;\t\n    };\n\n    ServiceApi.prototype.onKill = function(callback) {\n        this.onKillCallback = callback;\t\n    };\n    \n    ServiceApi.prototype.kill = function(callback) {\n    \tif (typeof this.onKillCallback == 'function') {\n    \t\tthis.onKillCallback(callback);\n    \t} else {\n    \t\tcallback(0);\n    \t}\n    };\n    \n    // Flow\n    // valueArray are return parameters of the service.\n    ServiceApi.prototype.finish = function(valueArray) {\n            //return execution to service caller\n            if (typeof this.onFinishCallback === 'function') {\n                    this.onFinishCallback(valueArray);\n            }\n    };\n\n    return ServiceApi;\n\n});\n\n","define('serviceApi/PseudoStorage',[],function(){\n    \n    function PseudoStorage() {\n    }\n\n    PseudoStorage.prototype.get = function(callback){\n        if (typeof callback === 'function') {\n            callback(null);\n        }\n        return null;\n    };\n\n    PseudoStorage.prototype.set = function(state, callback){\n        if (typeof callback === \"function\") {\n            callback();\n        }\n    };\n\n    return PseudoStorage;\n});\n","define('serviceApi/UserInfoService',['jquery'], function($){\n    \n    function UserInfoService(requestUrl, data) {\n        this.data = data;\n        this.requestUrl = requestUrl;\n    }\n\n    UserInfoService.prototype.get = function(property, callback){\n        if (this.data.hasOwnProperty(property)) {\n            if (typeof callback === \"function\") {\n                    callback(this.data[property]);\n            }\n        } else {\n            $.ajax({\n                url : this.requestUrl,\n                data \t\t: {\n                    'property' : property\n                },\n                type        : 'post',\n                dataType\t: 'json',\n                success     : (function(service, callback) {return function(r) {\n            \t\tfor (key in r.data) {\n            \t\t\tservice.data[key] = r.data[key];\n            \t\t}\n                    if (typeof callback === \"function\") {\n                        callback(service.data[property]);\n                    }\n\n                }})(this, callback)\n                /*\t\n            \tfunction(r){\n                    if(r.success){\n                    \tconsole.log(this.data);\n                    \tthis.data[property] = r.values;\n                    \t//console.log(this.data);\n\t                    if (typeof callback === \"function\") {\n\t                        callback(this.data[property]);\n\t                    }\n                    }\n                }\n                */\n                \n                \n            });\n        }\n    };\n\n    return UserInfoService;\n});\n","define('taoItems/runtime/ItemServiceImpl',[ 'jquery' ], function($) {\n\n    function ItemServiceImpl(data) {\n\n        this.itemId = data.itemId;\n        this.serviceApi = data.serviceApi;\n        this.resultApi = data.resultApi || null;\n        this.params = data.params || {};\n        this.responses = {};\n        this.scores = {};\n        this.events = {};\n        this.connected = false;\n\n        var rawstate = this.serviceApi.getState();\n        var state = (typeof rawstate === 'undefined' || rawstate === null) ? {}\n                : $.parseJSON(rawstate);\n        this.stateVariables = typeof state === 'object' ? state : {};\n\n        this.beforeFinishCallbacks = [];\n    }\n\n    ItemServiceImpl.prototype.connect = function(frame) {\n        if (this.connected === false && frame.contentWindow) {\n            frame.contentWindow.itemApi = this;\n            \n            if (typeof (frame.contentWindow.onItemApiReady) === \"function\") {\n                frame.contentWindow.onItemApiReady(this);\n                this.connected = true;\n            }\n        }\n    };\n\n    // Response\n\n    ItemServiceImpl.prototype.saveResponses = function(valueArray) {\n        for ( var attrname in valueArray) {\n            this.responses[attrname] = valueArray[attrname];\n        }\n    };\n\n    ItemServiceImpl.prototype.traceEvents = function(eventArray) {\n        for ( var attrname in eventArray) {\n            this.events[attrname] = eventArray[attrname];\n        }\n    };\n\n    // Scoring\n    ItemServiceImpl.prototype.saveScores = function(valueArray) {\n        for ( var attrname in valueArray) {\n            this.scores[attrname] = valueArray[attrname];\n        }\n    };\n\n    ItemServiceImpl.prototype.getUserPropertyValues = function(property,\n            callback) {\n        this.serviceApi.getUserPropertyValues(property, callback);\n    };\n\n    // Flow\n    ItemServiceImpl.prototype.beforeFinish = function(callback) {\n        this.beforeFinishCallbacks.push(callback);\n    };\n\n    ItemServiceImpl.prototype.finish = function() {\n        var self = this;\n        for ( var i = 0; i < this.beforeFinishCallbacks.length; i++) {\n            this.beforeFinishCallbacks[i]();\n        }\n\n        this.submit(function() {\n            self.serviceApi.finish();\n        });\n    };\n\n    ItemServiceImpl.prototype.submit = function(after) {\n        var self = this;\n\n        this.serviceApi.setState(JSON.stringify(self.stateVariables),\n                function() {\n                    // todo add item, call id etc\n\n                    if (self.resultApi) {\n                        self.resultApi\n                                .submitItemVariables(self.itemId,\n                                        self.serviceApi.getServiceCallId(),\n                                        self.responses, self.scores,\n                                        self.events, self.params, after);\n                    } else {\n                        after();\n                    }\n                });\n    }\n\n    ItemServiceImpl.prototype.onKill = function(callback) {\n        this.serviceApi.onKill(callback);\n    };\n\n    ItemServiceImpl.prototype.getVariable = function(identifier, callback) {\n        if (typeof callback === 'function') {\n            callback(this.stateVariables[identifier] || null);\n        }\n    };\n\n    ItemServiceImpl.prototype.setVariable = function(identifier, value) {\n        this.stateVariables[identifier] = value;\n        this.serviceApi.setState(JSON.stringify(this.stateVariables));\n    };\n\n    return ItemServiceImpl;\n});\n","/*  \n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n * \n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n * \n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n * \n * Copyright (c) 2008-2010 (original work) Deutsche Institut für Internationale Pädagogische Forschung (under the project TAO-TRANSFER);\n *               2009-2012 (update and modification) Public Research Centre Henri Tudor (under the project TAO-SUSTAIN & TAO-DEV);\n * \n */\ndefine('taoItems/preview/preview-console',['jquery'], function($){\n    /**\n     * Get an url-formated parameters string, parse it and return a JSONized object\n     * @param {String} params\n     * @returns {Object}\n     */\n    function unserializeUrl(params){\n        var data = {};\n        var hashes = params.split('&');\n        for(var i in hashes){\n                    if(typeof hashes[i] == 'string'){\n                            var hash = hashes[i].split('=');\n                            if(hash.length == 2){\n                                    if(/\\[\\]$/.test(hash[0])){\n                                            var key = hash[0].replace(/\\[\\]$/, '');\n                                            if(typeof(data[key]) == \"undefined\"){\n                                                    data[key] = [];\n                                            }\n                                            data[key].push(hash[1]);\n                                    }\n                                    else{\n                                            data[hash[0]] = hash[1];\n                                    }\n                            }\n                    }\n        }\n        return data;\n    }\n    \n    return {\n        \n        setup : function(){\n    \n\tvar timer = new Date();\n\t\n\t//get the console element in the top page\n\tvar $previewConsole = $('#preview-console', window.top.document);\n        var $consoleCtrls = $('.console-control', $previewConsole);\n        var $consoleContent = $('.console-content', $previewConsole);\n        var $consoleContentList = $('.console-content > ul', $previewConsole);\n\t\n\t//attach an updateConsole event, tobe triggered\n\t$previewConsole.bind('updateConsole', function(event, type, message){\n\t\tvar hour = timer.getHours();\n\t\tvar min\t = timer.getMinutes();\n\t\tvar sec\t = timer.getSeconds();\n\t\tvar logTime = ((hour>10)? hour : '0'+hour ) + ':' + ((min>10)? min : '0'+min) + ':' + ((sec>10)? sec: '0'+sec);\n\t\t$consoleContentList.append('<li><b>[' +  logTime  + '] ' + type + '</b>: ' + message + '</li>');\n\t});\n\t\n\t//controls: close console\n\t$(\".ui-icon-circle-close\", $consoleCtrls).on('click', function(event){\n                event.preventDefault();\n\t\t$previewConsole.hide();\n\t});\n\t\n\t//controls: clean console\n        $('.ui-icon-trash', $consoleCtrls).on('click', function(event){\n                event.preventDefault();\n\t\t$consoleContentList.empty();\n\t});\n\t\n\t//controls: show/hide console\n        $(\".toggler\", $consoleCtrls).on('click', function(event){\n                event.preventDefault();\n\t\t$consoleContent.toggle();\n                $(this).toggleClass('ui-icon-circle-minus')\n                        .toggleClass('ui-icon-circle-plus');\n\t});\n\t\n\t//log in the console the ajax request to the Preview Api\n\t$('body').ajaxSuccess(function(event, request, settings){\n\t\t\n\t\tif(/LegacyPreviewApi/.test(settings.url)){\n\t\t\t\n\t\t\tvar message = '';\n\t\t\t//taoApi Push\n\t\t\tif(/save$/.test(settings.url)){\n\t\t\t\tvar data = unserializeUrl(decodeURIComponent(settings.data));\n\t\t\t\tfor(var key in data){\n\t\t\t\t\tif(key !== 'token'){\n\t\t\t\t\t\tmessage += '<br />' + key + ' = '  + data[key] ;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(message !== ''){\n\t\t\t\t\tmessage += '<br />';\n\t\t\t\t\t$previewConsole.trigger('updateConsole', ['push data', message]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t//taoApi events\n\t\t\telse if(/traceEvents$/.test(settings.url)){\n\t\t\t\tvar data = unserializeUrl(decodeURIComponent(settings.data));\n\t\t\t\tif(data.events){\n\t\t\t\t\tfor(var index in data.events){\n\t\t\t\t\t\ttry{\n\t\t\t\t\t\t\tvar eventData = $.parseJSON(data.events[index]);\n\t\t\t\t\t\t\tmessage += '<br />' + eventData.type + ' on element ' + eventData.name;\n\t\t\t\t\t\t\tif(eventData.id !== 'noID'){\n\t\t\t\t\t\t\t\tmessage += '[id=' + eventData.id +']';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}catch(exp){ }\n\t\t\t\t\t}\n\t\t\t\t\tmessage += '<br />';\n\t\t\t\t\t$previewConsole.trigger('updateConsole', ['trace events', message]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t//wfApi saving context \n\t\t\telse if(/saveContext$/.test(settings.url)){\n\t\t\t\tvar data = unserializeUrl(decodeURIComponent(settings.data));\n\t\t\t\t\tfor(key in data){\n\t\t\t\t\t\tif(key !== 'token'){\n\t\t\t\t\t\t\tmessage += '<br />' + key + ' = ' + data[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tmessage += '<br />';\n\t\t\t\t\t$previewConsole.trigger('updateConsole', ['save context', message]);\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t//wfApi retrieve context \n\t\t\telse if(/retrieveContext$/.test(settings.url)){\n\t\t\t\tvar data = unserializeUrl(decodeURIComponent(settings.data));\n\t\t\t\t\tfor(key in data){\n\t\t\t\t\t\tif(key !== 'token'){\n\t\t\t\t\t\t\tmessage += '<br />' + key + ' = ' + data[key];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tmessage += '<br />';\n\t\t\t\t\t$previewConsole.trigger('updateConsole', ['retrieved context', message]);\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t\t//taoMatching data\n\t\t\telse if(/evaluate$/.test(settings.url)){\n\t\t\t\tvar data = unserializeUrl(decodeURIComponent(settings.data));\n\t\t\t\tif(data.data){\n\t\t\t\t\ttry{\n\t\t\t\t\t\tvar matchingDataList = $.parseJSON(data.data);\n\t\t\t\t\t\tfor(key in matchingDataList){\n\t\t\t\t\t\t\tmessage += '<br />' + matchingDataList[key]['identifier'] + ' = ' + matchingDataList[key]['value'];\n\t\t\t\t\t\t}\n\t\t\t\t\t}catch(exp){ \n\t\t\t\t\t\t//console.log(exp);\n\t\t\t\t\t}\n\t\t\t\t\tmessage += '<br />';\n\t\t\t\t\t$previewConsole.trigger('updateConsole', ['sent answers', message]);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\t//others requests\n\t\t\telse{\n\t\t\t\tmessage = \t'<br />' + \n\t\t\t\t\t\t\tsettings.type + ' ' + \n\t\t\t\t\t\t\tsettings.url + ' ? ' + \n\t\t\t\t\t\t\tdecodeURIComponent(settings.data) + ' => ' +\n\t\t\t\t\t\t\trequest.responseText;\n\t\t\t\t$previewConsole.trigger('updateConsole', ['remote request', message]);\n\t\t\t}\n\t\t}\n            });\n        }\n    };\n});\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine(\n    'taoItems/controller/preview/itemRunner',[\n        'module',\n        'jquery',\n        'lodash',\n        'serviceApi/ServiceApi',\n        'serviceApi/PseudoStorage',\n        'serviceApi/UserInfoService',\n        'taoItems/runtime/ItemServiceImpl',\n        'taoItems/preview/preview-console',\n        'urlParser',\n        'iframeResizer'\n    ],\n    function (\n        module,\n        $,\n        _,\n        ServiceApi,\n        PseudoStorage,\n        UserInfoService,\n        ItemServiceImpl,\n        previewConsole,\n        UrlParser,\n        iframeResizer\n        ) {\n\n        var previewItemRunner = {\n\n            start: function (options) {\n\n                var conf = _.merge(module.config(), options || {});\n\n                if (conf.previewUrl) {\n\n                    previewConsole.setup();\n\n                    var resultServer = _.defaults(conf.resultServer, {\n                        module: 'taoResultServer/ResultServerApi',\n                        endpoint: '',\n                        params: {}\n                    });\n\n                    //load dynamically the right ResultServerApi\n                    require([resultServer.module], function (ResultServerApi) {\n\n                        var resultServerApi = new ResultServerApi(\n                            resultServer.endpoint,\n                            resultServer.params\n                        );\n\n                        var serviceApi = new ServiceApi(\n                            conf.previewUrl,\n                            {},\n                            'preview',\n                            new PseudoStorage(),\n                            new UserInfoService(conf.userInfoServiceRequestUrl, {})\n                        );\n\n                        var itemApi = new ItemServiceImpl({\n                            serviceApi: serviceApi,\n                            resultApi: resultServerApi\n                        });\n\n                        var callUrl = new UrlParser(serviceApi.getCallUrl());\n                        var isCORSAllowed = callUrl.checkCORS();\n                        callUrl.addParam('clientConfigUrl', conf.clientConfigUrl);\n\n                        var $frame = $('#preview-container');\n\n                        iframeResizer.autoHeight($frame, 'body', 10);\n\n\n\n                        $frame.on('load', function () {\n                            var frame = this;\n\n                            //1st try to connect the api on frame load\n                            itemApi.connect(frame);\n\n                            //if we are  in the same domain, we add a variable\n                            //to the frame window, so the frame knows it can communicate\n                            //with the parent\n                            if (isCORSAllowed === true) {\n                                frame.contentWindow.__knownParent__ = true;\n                            }\n                            //then we can wait a specific event triggered from the item\n                            $(document).on('itemready', function () {\n                                itemApi.connect(frame);\n                            });\n\n                        });\n                        $('#preview-container').attr('src', callUrl.getUrl());\n\n                        $('#finishButton').click(function () {\n                            itemApi.finish();\n                        });\n                    });\n                }\n            }\n        };\n\n        return previewItemRunner;\n    });\n","/**\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n *\n * Copyright (c) 2013 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\n *\n *\n */\ndefine('taoItems/controller/runtime/itemRunner',['jquery', 'lodash', 'iframeResizer', 'iframeNotifier', 'urlParser'],\n    function($, _, iframeResizer, iframeNotifier, UrlParser){\n\n        var itemRunner = {\n            start : function(options){\n\n                var $frame = $('<iframe id=\"item-container\" class=\"toolframe\" frameborder=\"0\" style=\"width:100%;height:100%;overflow:hidden\" scrolling=\"no\"></iframe>');\n                $frame.appendTo('body');\n                var itemId = options.itemId;\n                var itemPath = options.itemPath;\n                var resultServer = _.defaults(options.resultServer, {\n                    module : 'taoResultServer/ResultServerApi',\n                    params : {}\n                });\n                var itemService = _.defaults(options.itemService, {\n                    module : 'taoItems/runtime/ItemServiceImpl',\n                    params : {}\n                });\n                var clientConfigUrl = options.clientConfigUrl;\n                var timeout = options.timeout || 30;\n\n                //load dynamically the right ItemService and ResultServerApi\n                require([itemService.module, resultServer.module], function(ItemService, ResultServerApi){\n\n                    var resultServerApi = new ResultServerApi(resultServer.endpoint, resultServer.params);\n\n                    window.onServiceApiReady = function(serviceApi){\n                        \n                        var itemApi = new ItemService(_.merge({\n                            serviceApi : serviceApi,\n                            itemId : itemId,\n                            resultApi : resultServerApi\n                        }, {\n                            params : itemService.params\n                        }));\n\n                        var itemUrl = new UrlParser(itemPath);\n                        var isCORSAllowed = itemUrl.checkCORS();\n                        itemUrl.addParam('clientConfigUrl', clientConfigUrl);\n                        itemUrl.addParam('timeout', timeout);\n\n                        iframeResizer.autoHeight($frame, 'body', 10);\n                        \n                        $(document).on('itemloaded', function() {\n                            iframeNotifier.parent('serviceloaded');\n                        });\n                        \n                        $(document).on('itemready', function() {\n                            // item is ready, we can connect.\n                            itemApi.connect($frame[0]);\n                        });\n                        \n                        $frame.on('load', function(){\n                            itemApi.connect($frame[0]);\n                            \n                            if (isCORSAllowed === true) {\n                                this.contentWindow.__knownParent__ = true;\n                            }\n                        }); \n                        $frame.attr('src', itemUrl.getUrl());\n                    };\n\n                    //tell the parent he can trigger onServiceApiReady\n                    _.defer(function(){\n                        iframeNotifier.parent('serviceready');\n                    });\n                });\n            }\n        };\n\n        return itemRunner;\n    });\n\n"]}