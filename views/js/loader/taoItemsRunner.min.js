function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}define("taoItems/assets/manager",["lodash","util/url"],function(_,urlUtil){"use strict";function _interopDefaultLegacy(e){return e&&"object"===_typeof(e)&&"default"in e?e:{default:e}}var ___default=_interopDefaultLegacy(_),urlUtil__default=_interopDefaultLegacy(urlUtil),checkStrategy=function checkStrategy(strategy){if(!___default["default"].isPlainObject(strategy)||!___default["default"].isFunction(strategy.handle)||!___default["default"].isString(strategy.name))throw new TypeError("An asset resolution strategy is an object with a handle method and a name")},assetManagerFactory=function assetManagerFactory(strategies,data,options){var assetManager,cache={};return strategies=___default["default"].isArray(strategies)?strategies:[strategies],data=data||{},options=___default["default"].defaults(options||{},{parseUrl:!0}),assetManager={_strategies:[],addStrategy:function addStrategy(strategy){checkStrategy(strategy),this._strategies.push(strategy)},prependStrategy:function prependStrategy(strategy){checkStrategy(strategy),this._strategies.unshift(strategy)},setStrategies:function setStrategies(newStrategies){var self=this;this._strategies=[],___default["default"].forEach(newStrategies,function(strategy){___default["default"].isPlainObject(strategy)?assetManager.addStrategy(strategy):___default["default"].isFunction(strategy)&&self.addStrategy({name:"strategy_".concat(self._strategies.length+1),handle:strategy})})},setData:function setData(key,value){___default["default"].isString(key)&&"undefined"!=typeof value?data[key]=value:___default["default"].isPlainObject(key)&&(data=key)},getData:function getData(key){return ___default["default"].isString(key)?data[key]:data},resolve:function resolve(url){var resolved,inputUrl;return options.cache&&"undefined"!=typeof cache[url]?cache[url]:(inputUrl=options.parseUrl?urlUtil__default["default"].parse(url):url,___default["default"].forEach(this._strategies,function(strategy){var result=strategy.handle(inputUrl,data);if(result)return resolved=result,!1}),resolved=resolved||"",options.cache&&(cache[url]=resolved),resolved)},resolveBy:function resolveBy(name,url){var inputUrl,resolved="",strategy=___default["default"].find(this._strategies,{name:name});return strategy&&(inputUrl=options.parseUrl?urlUtil__default["default"].parse(url):url,resolved=strategy.handle(inputUrl,data)),resolved},clearCache:function clearCache(){options.cache&&(cache={})}},assetManager.setStrategies(strategies),assetManager};return assetManagerFactory}),define("taoItems/assets/strategies",["util/url","lodash"],function(urlUtil,_){"use strict";function _interopDefaultLegacy(e){return e&&"object"===_typeof(e)&&"default"in e?e:{default:e}}var urlUtil__default=_interopDefaultLegacy(urlUtil),___default=_interopDefaultLegacy(_),prependToUrl=function prependToUrl(url,base,slashcat){return!0===slashcat?"".concat(base.replace(/\/$/,""),"/").concat(url.directory.replace(/^\.\//,"").replace(/^\//,"")).concat(encodeURIComponent(url.file.replace(/^\.\//,"").replace(/^\//,""))):base+url.directory.replace(/^\.?\//,"")+encodeURIComponent(url.file.replace(/^\.?\//,""))},strategies={packedUrl:{name:"packedUrl",handle:function handlePackedUrl(url,data){var type;if(!___default["default"].isUndefined(url.source)&&!___default["default"].isUndefined(data.assets)&&(type=___default["default"].findKey(data.assets,url.source),type&&urlUtil__default["default"].isAbsolute(data.assets[type][url.source])))return data.assets[type][url.source]}},baseUrl:{name:"baseUrl",handle:function handleBaseUrl(url,data){if("string"==typeof data.baseUrl&&urlUtil__default["default"].isRelative(url))return prependToUrl(url,data.baseUrl,data.slashcat)}},itemCssNoCache:{name:"itemCssNoCache",handle:function handleItemCss(url,data){if("string"==typeof data.baseUrl&&urlUtil__default["default"].isRelative(url)&&/\.css$/.test(url.file))return urlUtil__default["default"].build(prependToUrl(url,data.baseUrl,data.slashcat),{bust:Date.now()})}},external:{name:"external",handle:function handleExternal(url){if(urlUtil__default["default"].isAbsolute(url))return url.toString()}},base64:{name:"base64",handle:function handleB64(url){if(urlUtil__default["default"].isBase64(url))return url.toString()}},taomedia:{name:"taomedia",handle:function handleTaoMedia(url,data){var baseUrl=data.baseUrl||"./";if("object"===_typeof(url)&&"taomedia"===url.protocol||/^taomedia:\/\//.test(url.toString()))return baseUrl+url.toString()}}};return strategies}),define("taoItems/runner/api/itemRunner",["jquery","core/eventifier","taoItems/assets/manager"],function($,eventifier,assetManagerFactory){"use strict";function _interopDefaultLegacy(e){return e&&"object"===_typeof(e)&&"default"in e?e:{default:e}}var $__default=_interopDefaultLegacy($),eventifier__default=_interopDefaultLegacy(eventifier),assetManagerFactory__default=_interopDefaultLegacy(assetManagerFactory),itemRunnerFactory=function itemRunnerFactory(providerName){var data=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},options=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},flow={init:{done:!1,pending:[]},render:{done:!1,pending:[]}};"object"===_typeof(providerName)&&(data=providerName,providerName=void 0);var providers=itemRunnerFactory.providers;if(!providers||0===Object.keys(providers).length)throw new Error("No provider registered");var provider;if("string"==typeof providerName&&0<providerName.length?provider=providers[providerName]:1===Object.keys(providers).length&&(providerName=Object.keys(providers)[0],provider=providers[providerName]),!provider)throw new Error("No candidate found for the provider");var assetManager=options.assetManager||assetManagerFactory__default["default"](function defaultStrategy(url){return url.toString()}),suspended=!1,closed=!1;return eventifier__default["default"]({container:null,assetManager:assetManager,options:options,init:function init(newData){var _this=this,initDone=function initDone(){!1===flow.init.done&&(flow.init.done=!0,flow.init.pending.filter(function(pendingTask){return"function"==typeof pendingTask}).forEach(function(pendingTask){return pendingTask()}),flow.init.pending=[]),_this.trigger("init")};return newData&&(data=Object.assign(data,newData)),"function"==typeof provider.init?provider.init.call(this,data,initDone):initDone(),this},assets:function assets(strategies,contextData,assetManagerOptions){try{this.assetManager=assetManagerFactory__default["default"](strategies,contextData,assetManagerOptions)}catch(err){this.trigger("error",new Error("Something was wrong while configuring the asset manager : ".concat(err.message)))}return this},render:function render(elt){var _this2=this,newOptions=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},renderDone=function renderDone(){!1===flow.render.done&&(flow.render.done=!0,flow.render.pending.filter(function(pendingTask){return"function"==typeof pendingTask}).forEach(function(pendingTask){return pendingTask()}),flow.render.pending=[]),_this2.trigger("render"),_this2.trigger("ready")};return(options=Object.assign(options||{},newOptions),options.state||(options.state={}),!(elt instanceof HTMLElement)&&!(elt instanceof $__default["default"]))?this.trigger("error",new Error("A valid HTMLElement (or a jquery element) at least is required to render the item")):(options.state&&this.setState(options.state,!0),!1===flow.init.done?flow.init.pending.push(function(){return _this2.render(elt,options)}):(this.container=elt instanceof $__default["default"]?elt.get(0):elt,"function"==typeof provider.render?provider.render.call(this,this.container,renderDone,options):renderDone()),this)},clear:function clear(){var _this3=this,clearDone=function clearDone(){_this3.trigger("clear")};return"function"==typeof provider.clear?provider.clear.call(this,this.container,clearDone):clearDone(),this},getState:function getState(){return"function"==typeof provider.getState?provider.getState.call(this):null},setState:function setState(state){var _this4=this,isInitialStateRestore=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];return!state||"object"!==_typeof(state)||Array.isArray(state)?this.trigger("error",new Error("The item's state must be a JavaScript Plain Object: ".concat(_typeof(state)," given"))):(!1===flow.render.done?flow.render.pending.push(function(){return _this4.setState(state,isInitialStateRestore)}):"function"==typeof provider.setState&&provider.setState.call(this,state,isInitialStateRestore),this)},getData:function getData(){return data},setData:function setData(itemData){return data=itemData,"function"==typeof provider.setData?provider.setData.call(this,itemData):Promise.resolve()},getOptions:function getOptions(){return this.options},setOptions:function setOptions(){var newOptions=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.options=newOptions,"function"==typeof provider.setOptions?provider.setOptions.call(this,this.options):Promise.resolve()},getResponses:function getResponses(){return"function"==typeof provider.getResponses?provider.getResponses.call(this):{}},renderFeedbacks:function renderFeedbacks(feedbacks,itemSession,done){"function"==typeof provider.renderFeedbacks&&provider.renderFeedbacks.call(this,feedbacks,itemSession,done)},suspend:function suspend(){return!suspended&&flow.render.done&&"function"==typeof provider.suspend?provider.suspend.call(this).then(function(result){return suspended=!0,result}):Promise.resolve()},close:function close(){return!closed&&flow.render.done&&"function"==typeof provider.close?provider.close.call(this).then(function(result){return closed=!0,result}):Promise.resolve()},resume:function resume(){return(suspended||closed)&&flow.render.done&&"function"==typeof provider.resume?provider.resume.call(this).then(function(result){return suspended=!1,closed=!1,result}):Promise.resolve()},isSuspended:function isSuspended(){return suspended},isClosed:function isClosed(){return closed}})};return itemRunnerFactory.register=function registerProvider(name,provider){if("string"!=typeof name||0>=name.length)throw new TypeError("It is required to give a name to your provider.");if("object"!==_typeof(provider)||"function"!=typeof provider.init&&"function"!=typeof provider.render)throw new TypeError("A provider is an object that contains at least an init function or a render function.");this.providers=this.providers||{},this.providers[name]=provider},itemRunnerFactory}),define("taoItems/loader/taoItemsRunner.bundle",function(){});
//# sourceMappingURL=taoItemsRunner.min.js.map